(function(E){typeof define=="function"&&define.amd?define(E):E()})(function(){"use strict";var Ts=Object.defineProperty;var fs=(E,f,v)=>f in E?Ts(E,f,{enumerable:!0,configurable:!0,writable:!0,value:v}):E[f]=v;var i=(E,f,v)=>fs(E,typeof f!="symbol"?f+"":f,v);const E="TOK_LPAREN",f="TOK_RPAREN",v="TOK_LCURLY",Ge="TOK_RCURLY",Pe="TOK_LSQUAR",De="TOK_RSQUAR",A="TOK_COMMA",We="TOK_DOT",F="TOK_PLUS",G="TOK_MINUS",M="TOK_STAR",B="TOK_SLASH",Q="TOK_CARET",Y="TOK_MOD",He="TOK_COLON",Ce="TOK_SEMICOLON",Ve="TOK_QUESTION",Pt="TOK_NOT",z="TOK_GT",q="TOK_LT",Me="TOK_EQ",j="TOK_GE",J="TOK_LE",X="TOK_NE",Z="TOK_EQEQ",tt="TOK_ASSIGN",P="TOK_IDENTIFIER",Dt="TOK_STRING",Wt="TOK_INTEGER",Ht="TOK_FLOAT",et="TOK_IF",Ct="TOK_THEN",st="TOK_ELSE",Vt="TOK_TRUE",Mt="TOK_FALSE",D="TOK_AND",W="TOK_OR",it="TOK_WHILE",nt="TOK_DO",rt="TOK_FOR",ht="TOK_FUNC",Be="TOK_NULL",R="TOK_END",ot="TOK_PRINT",ct="TOK_PRINTLN",at="TOK_RET",Qe={if:et,else:st,then:Ct,true:Vt,false:Mt,and:D,or:W,while:it,do:nt,for:rt,func:ht,null:Be,end:R,print:ot,println:ct,ret:at};let Ye=class{constructor(t,e,s){i(this,"tokenType");i(this,"lexeme");i(this,"line");this.tokenType=t,this.lexeme=e,this.line=s}toString(){return`(${this.tokenType}, '${this.lexeme}', ${this.line})`}};function Bt(r){let t="",e=0,s=!1;for(let n of String(r))n==="("?(s||(t+=""),t+=n+`
`,e+=2,s=!0):n===")"?(s||(t+=`
`),e-=2,s=!0,t+=" ".repeat(e)+n+`
`):(s&&(t+=" ".repeat(e)),t+=n,s=!1);console.log(t)}function I(r){return typeof r=="boolean"?r?"true":"false":typeof r=="number"&&Number.isInteger(r)?r.toString():String(r)}function y(r,t){throw console.error(`${o.RED}[Line ${t}]: ${r} ${o.WHITE}`),new Error(`[Line ${t}]: ${r}`)}function L(r,t){throw console.error(`${o.RED}[Line ${t}]: ${r} ${o.WHITE}`),new Error(`[Line ${t}]: ${r}`)}function T(r,t){throw console.error(`${o.RED}[Line ${t}]: ${r} ${o.WHITE}`),new Error(`[Line ${t}]: ${r}`)}class o{}i(o,"WHITE","\x1B[0m"),i(o,"BLUE","\x1B[94m"),i(o,"CYAN","\x1B[96m"),i(o,"GREEN","\x1B[92m"),i(o,"YELLOW","\x1B[93m"),i(o,"RED","\x1B[91m");let ze=class{constructor(t){i(this,"tokens");i(this,"source");i(this,"start");i(this,"curr");i(this,"line");this.source=t,this.start=0,this.curr=0,this.line=1,this.tokens=[]}advance(){const t=this.source[this.curr];return this.curr++,t}peek(){return this.curr>=this.source.length?"\0":this.source[this.curr]}lookahead(t=1){return this.curr+t>=this.source.length?"\0":this.source[this.curr+t]}match(t){return this.curr>=this.source.length||this.source[this.curr]!==t?!1:(this.curr++,!0)}handleNumber(){for(;/\d/.test(this.peek());)this.advance();if(this.peek()==="."&&/\d/.test(this.lookahead())){for(this.advance();/\d/.test(this.peek());)this.advance();this.addToken(Ht)}else this.addToken(Wt)}handleString(t){for(;this.peek()!==t&&this.curr<this.source.length;)this.advance();this.curr>=this.source.length&&y("Unterminated string.",this.line),this.advance(),this.addToken(Dt)}handleIdentifier(){for(;/\w/.test(this.peek());)this.advance();const t=this.source.substring(this.start,this.curr),e=Qe[t]||P;this.addToken(e)}addToken(t){const e=this.source.substring(this.start,this.curr);this.tokens.push(new Ye(t,e,this.line))}tokenize(){for(;this.curr<this.source.length;){this.start=this.curr;const t=this.advance();switch(t){case`
`:this.line++;break;case" ":case"	":case"\r":break;case"(":this.addToken(E);break;case")":this.addToken(f);break;case"{":this.addToken(v);break;case"}":this.addToken(Ge);break;case"[":this.addToken(Pe);break;case"]":this.addToken(De);break;case".":this.addToken(We);break;case",":this.addToken(A);break;case"+":this.addToken(F);break;case"*":this.addToken(M);break;case"^":this.addToken(Q);break;case"/":this.addToken(B);break;case";":this.addToken(Ce);break;case"?":this.addToken(Ve);break;case"%":this.addToken(Y);break;case"-":if(this.match("-"))for(;this.peek()!==`
`&&this.curr<this.source.length;)this.advance();else this.addToken(G);break;case"#":for(;this.peek()!==`
`&&this.curr<this.source.length;)this.advance();break;case"=":this.addToken(this.match("=")?Z:Me);break;case"~":this.addToken(this.match("=")?X:Pt);break;case"<":this.addToken(this.match("=")?J:q);break;case">":this.addToken(this.match("=")?j:z);break;case":":this.addToken(this.match("=")?tt:He);break;case'"':case"'":this.handleString(t);break;default:/\d/.test(t)?this.handleNumber():/\w/.test(t)?this.handleIdentifier():y(`Error at '${t}': Unexpected character.`,this.line)}}return this.tokens}},lt=class{},x=class extends lt{},S=class extends lt{},Qt=class extends S{},Yt=class extends x{constructor(e,s){super();i(this,"value");i(this,"line");if(!Number.isInteger(e))throw new Error(`Invalid Integer value: ${e}`);this.value=e,this.line=s}toString(){return`Integer[${this.value}]`}},zt=class extends x{constructor(e,s){super();i(this,"value");i(this,"line");if(typeof e!="number")throw new Error(`Invalid Float value: ${e}`);this.value=e,this.line=s}toString(){return`Float[${this.value}]`}},ut=class extends x{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`Bool[${this.value}]`}},qt=class extends x{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`String[${this.value}]`}},jt=class extends x{constructor(e,s,n){super();i(this,"op");i(this,"operand");i(this,"line");this.op=e,this.operand=s,this.line=n}toString(){return`UnOp(${this.op.lexeme}, ${this.operand})`}},K=class extends x{constructor(e,s,n,h){super();i(this,"op");i(this,"left");i(this,"right");i(this,"line");this.op=e,this.left=s,this.right=n,this.line=h}toString(){return`BinOp(${this.op.lexeme}, ${this.left}, ${this.right})`}},pt=class extends x{constructor(e,s,n,h){super();i(this,"op");i(this,"left");i(this,"right");i(this,"line");this.op=e,this.left=s,this.right=n,this.line=h}toString(){return`LogicalOp(${this.op.lexeme}, ${this.left}, ${this.right})`}},Jt=class extends x{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`Grouping(${this.value})`}},Xt=class extends x{constructor(e,s){super();i(this,"name");i(this,"line");this.name=e,this.line=s}toString(){return`Identifier[${this.name}]`}},Zt=class extends lt{constructor(e,s){super();i(this,"statements");i(this,"line");this.statements=e,this.line=s}toString(){return`Stmts(${this.statements})`}},te=class extends S{constructor(e,s,n){super();i(this,"value");i(this,"end");i(this,"line");this.value=e,this.end=s,this.line=n}toString(){return`PrintStmt(${this.value}, end=${this.end})`}},ee=class extends S{constructor(e,s,n,h){super();i(this,"test");i(this,"thenStatements");i(this,"elseStatements");i(this,"line");this.test=e,this.thenStatements=s,this.elseStatements=n,this.line=h}toString(){return`IfStmt(${this.test}, then: ${this.thenStatements}, else: ${this.elseStatements})`}},se=class extends S{constructor(e,s,n){super();i(this,"test");i(this,"bodyStatements");i(this,"line");this.test=e,this.bodyStatements=s,this.line=n}toString(){return`WhileStmt(${this.test}, ${this.bodyStatements})`}},ie=class extends S{constructor(e,s,n){super();i(this,"left");i(this,"right");i(this,"line");this.left=e,this.right=s,this.line=n}toString(){return`Assignment(${this.left}, ${this.right})`}},ne=class extends S{constructor(e,s,n,h,c,u){super();i(this,"identifier");i(this,"start");i(this,"end");i(this,"step");i(this,"bodyStatements");i(this,"line");this.identifier=e,this.start=s,this.end=n,this.step=h,this.bodyStatements=c,this.line=u}toString(){return`ForStmt(${this.identifier}, ${this.start}, ${this.end}, ${this.step}, ${this.bodyStatements})`}},re=class extends Qt{constructor(e,s,n,h){super();i(this,"name");i(this,"params");i(this,"bodyStatements");i(this,"line");this.name=e,this.params=s,this.bodyStatements=n,this.line=h}toString(){return`FuncDecl(${this.name}, ${this.params}, ${this.bodyStatements})`}},qe=class extends Qt{constructor(e,s){super();i(this,"name");i(this,"line");this.name=e,this.line=s}toString(){return`Param(${this.name})`}},he=class extends x{constructor(e,s,n){super();i(this,"name");i(this,"args");i(this,"line");this.name=e,this.args=s,this.line=n}toString(){return`FuncCall(${this.name}, ${this.args})`}},oe=class extends S{constructor(e){super();i(this,"expression");this.expression=e}toString(){return`FuncCallStmt(${this.expression})`}},ce=class extends S{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`RetStmt(${this.value})`}},je=class{constructor(t){i(this,"tokens");i(this,"curr");this.tokens=t,this.curr=0}advance(){const t=this.tokens[this.curr];return this.curr++,t}peek(){return this.tokens[this.curr]}isNext(t){return this.curr<this.tokens.length&&this.peek().tokenType===t}expect(t){if(this.curr>=this.tokens.length)L("Unexpected end of input",this.previousToken().line);else{if(this.peek().tokenType===t)return this.advance();L(`Expected ${t}, but found ${this.peek().lexeme}.`,this.peek().line)}}previousToken(){return this.tokens[this.curr-1]}match(t){return this.curr<this.tokens.length&&this.peek().tokenType===t?(this.curr++,!0):!1}primary(){if(this.match(Wt))return new Yt(parseInt(this.previousToken().lexeme),this.previousToken().line);if(this.match(Ht))return new zt(parseFloat(this.previousToken().lexeme),this.previousToken().line);if(this.match(Vt))return new ut(!0,this.previousToken().line);if(this.match(Mt))return new ut(!1,this.previousToken().line);if(this.match(Dt))return new qt(this.previousToken().lexeme.slice(1,-1),this.previousToken().line);if(this.match(E)){const t=this.expr();return this.expect(f),t?new Jt(t,this.previousToken().line):null}else{const t=this.expect(P);if(typeof t<"u"){if(this.match(E)){const e=this.args();return this.expect(f),new he(t.lexeme,e,this.previousToken().line)}return new Xt(t.lexeme,this.previousToken().line)}return null}}unary(){if(this.match(Pt)||this.match(G)||this.match(F)){const t=this.previousToken(),e=this.unary();return e?new jt(t,e,t.line):null}return this.primary()}exponent(){let t=this.unary();for(;this.match(Q);){const e=this.previousToken(),s=this.exponent();t&&s&&(t=new K(e,t,s,e.line))}return t}modulo(){let t=this.exponent();for(;this.match(Y);){const e=this.previousToken(),s=this.exponent();t&&s&&(t=new K(e,t,s,e.line))}return t}multiplication(){let t=this.modulo();for(;this.match(M)||this.match(B);){const e=this.previousToken(),s=this.modulo();t&&s&&(t=new K(e,t,s,e.line))}return t}addition(){let t=this.multiplication();for(;this.match(F)||this.match(G);){const e=this.previousToken(),s=this.multiplication();t&&s&&(t=new K(e,t,s,e.line))}return t}comparison(){let t=this.addition();for(;this.match(z)||this.match(j)||this.match(q)||this.match(J);){const e=this.previousToken(),s=this.addition();t&&s&&(t=new K(e,t,s,e.line))}return t}equality(){let t=this.comparison();for(;this.match(X)||this.match(Z);){const e=this.previousToken(),s=this.comparison();t&&s&&(t=new K(e,t,s,e.line))}return t}logicalAnd(){let t=this.equality();for(;this.match(D);){const e=this.previousToken(),s=this.equality();t&&s&&(t=new pt(e,t,s,e.line))}return t}logicalOr(){let t=this.logicalAnd();for(;this.match(W);){const e=this.previousToken(),s=this.logicalAnd();t&&s&&(t=new pt(e,t,s,e.line))}return t}expr(){return this.logicalOr()}printStmt(t){if(this.match(ot)||this.match(ct)){const e=this.expr();return e?new te(e,t,this.previousToken().line):null}return null}ifStmt(){this.expect(et);const t=this.expr();this.expect(Ct);const e=this.stmts();let s=null;return this.isNext(st)&&(this.advance(),s=this.stmts()),this.expect(R),t?new ee(t,e,s,this.previousToken().line):null}whileStmt(){this.expect(it);const t=this.expr();this.expect(nt);const e=this.stmts();return this.expect(R),t?new se(t,e,this.previousToken().line):null}forStmt(){this.expect(rt);const t=this.primary();this.expect(tt);const e=this.expr();this.expect(A);const s=this.expr();let n=null;this.isNext(A)&&(this.advance(),n=this.expr()),this.expect(nt);const h=this.stmts();return this.expect(R),t&&e&&s?new ne(t,e,s,n,h,this.previousToken().line):null}args(){let t=[];for(;!this.isNext(f);){let e=this.expr();e&&(t.push(e),this.isNext(f)||this.expect(A))}return t}params(){const t=[];let e=0;for(;!this.isNext(f);){const s=this.expect(P);typeof s>"u"||(e++,e>255&&L("Functions cannot have more than 255 parameters.",s?s.line:0),t.push(new qe(s.lexeme,this.previousToken().line)),this.isNext(f)||this.expect(A))}return t}funcDecl(){this.expect(ht);const t=this.expect(P);if(typeof t>"u")return null;this.expect(E);const e=this.params();this.expect(f);const s=this.stmts();return this.expect(R),new re(t.lexeme,e,s,t.line)}retStmt(){this.expect(at);const t=this.expr();return t?new ce(t,this.previousToken().line):null}stmt(){const t=this.peek().tokenType;if(t===ot)return this.printStmt("");if(t===ct)return this.printStmt(`
`);if(t===et)return this.ifStmt();if(t===it)return this.whileStmt();if(t===rt)return this.forStmt();if(t===ht)return this.funcDecl();if(t===at)return this.retStmt();const e=this.expr();if(!e)return null;if(this.match(tt)){const s=this.expr();return s?new ie(e,s,this.previousToken().line):null}return new oe(e)}stmts(){const t=[];for(;this.curr<this.tokens.length&&!this.isNext(st)&&!this.isNext(R);){let e=this.stmt();e&&t.push(e)}return new Zt(t,this.previousToken().line)}program(){return this.stmts()}parse(){return this.program()}},Je=class Fe{constructor(t=null){i(this,"vars");i(this,"funcs");i(this,"parent");this.vars={},this.funcs={},this.parent=t}getVar(t){let e=this;for(;e;){if(t in e.vars)return e.vars[t];e=e.parent}}setVar(t,e){let s=this;for(;s;){if(t in s.vars)return s.vars[t]=e,e;s=s.parent}return this.vars[t]=e,e}getFunc(t){let e=this;for(;e;){if(t in e.funcs)return e.funcs[t];e=e.parent}}setFunc(t,e){this.funcs[t]=e}newEnv(){return new Fe(this)}},ae=class extends Error{constructor(e){super("Return statement");i(this,"value");this.value=e}};const a="TYPE_NUMBER",m="TYPE_STRING",O="TYPE_BOOL";let Xe=class{interpret(t,e){if(t instanceof Yt)return[a,t.value];if(t instanceof zt)return[a,t.value];if(t instanceof qt)return[m,t.value];if(t instanceof ut)return[O,t.value];if(t instanceof Jt)return this.interpret(t.value,e);if(t instanceof Xt){const s=e.getVar(t.name);return s||T(`Undeclared identifier '${t.name}'`,t.line),s[1]===null&&T(`Uninitialized identifier '${t.name}'`,t.line),s}if(t instanceof ie){const[s,n]=this.interpret(t.right,e);e.setVar(t.left.name,[s,n])}if(t instanceof K){const[s,n]=this.interpret(t.left,e),[h,c]=this.interpret(t.right,e);switch(t.op.tokenType){case F:if(s===a&&h===a)return[a,n+c];if(s===m||h===m)return[m,I(n)+I(c)];break;case G:if(s===a&&h===a)return[a,n-c];break;case M:if(s===a&&h===a)return[a,n*c];break;case B:if(h===0&&T("Division by zero.",t.line),s===a&&h===a)return[a,n/c];break;case Y:if(s===a&&h===a)return[a,n%c];break;case Q:if(s===a&&h===a)return[a,n**c];break;case z:if(s===a&&h===a||s===m&&h===m)return[O,n>c];break;case j:if(s===a&&h===a||s===m&&h===m)return[O,n>=c];break;case q:if(s===a&&h===a||s===m&&h===m)return[O,n<c];break;case J:if(s===a&&h===a||s===m&&h===m)return[O,n<=c];break;case Z:if(s===a&&h===a||s===m&&h===m||s===O&&h===O)return[O,n===c];break;case X:if(s===a&&h===a||s===m&&h===m||s===O&&h===O)return[O,n!==c];break;default:T(`Unsupported operator '${t.op.lexeme}'`,t.line)}}if(t instanceof jt){const[s,n]=this.interpret(t.operand,e);switch(t.op.tokenType){case"TOK_MINUS":if(s===a)return[a,-n];break;case"TOK_PLUS":if(s===a)return[a,n];break;case"TOK_NOT":if(s===O)return[O,!n];break;default:T(`Unsupported operator '${t.op.lexeme}'`,t.line)}}if(t instanceof pt){const[s,n]=this.interpret(t.left,e);switch(t.op.tokenType){case W:if(n)return[s,n];break;case D:if(!n)return[s,n];break}return this.interpret(t.right,e)}if(t instanceof Zt)for(const s of t.statements)this.interpret(s,e);if(t instanceof te){const[,s]=this.interpret(t.value,e);console.log(I(s),t.end===`
`?`
`:"")}if(t instanceof ee){const[s,n]=this.interpret(t.test,e);s!==O&&T("Condition test is not a boolean expression.",t.line),n?this.interpret(t.thenStatements,e.newEnv()):t.elseStatements&&this.interpret(t.elseStatements,e.newEnv())}if(t instanceof se)for(;;){const[s,n]=this.interpret(t.test,e);if(s!==O&&T("While test is not a boolean expression.",t.line),!n)break;this.interpret(t.bodyStatements,e.newEnv())}if(t instanceof ne){const s=t.identifier.name,[,n]=this.interpret(t.start,e),[,h]=this.interpret(t.end,e),c=e.newEnv();let u;if(n<h){u=t.step?this.interpret(t.step,e)[1]:1;for(let p=n;p<=h;p+=u)e.setVar(s,[a,p]),this.interpret(t.bodyStatements,c)}else{u=t.step?this.interpret(t.step,e)[1]:-1;for(let p=n;p>=h;p+=u)e.setVar(s,[a,p]),this.interpret(t.bodyStatements,c)}}if(t instanceof re&&e.setFunc(t.name,[t,e]),t instanceof he){const s=e.getFunc(t.name);s||T(`Function '${t.name}' not declared.`,t.line);const[n,h]=s;t.args.length!==n.params.length&&T(`Function '${n.name}' expected ${n.params.length} arguments but got ${t.args.length}.`,t.line);const c=h.newEnv();n.params.forEach((u,p)=>{c.setVar(u.name,this.interpret(t.args[p],e))});try{this.interpret(n.bodyStatements,c)}catch(u){if(u instanceof ae)return u.value;throw u}}if(t instanceof oe&&this.interpret(t.expression,e),t instanceof ce)throw new ae(this.interpret(t.value,e))}interpretAst(t){const e=new Je;this.interpret(t,e)}};function Ze(r){try{console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}SOURCE:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(r),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}TOKENS:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`);const t=new ze(r);let e;e=t.tokenize(),e.forEach(c=>console.log(c)),console.log(),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}AST:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`);const n=new je(e).parse();Bt(n.toString()),console.log(),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}INTERPRETER:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`),new Xe().interpretAst(n)}catch(t){t instanceof Error?console.error(`Error: ${t.message}`):console.error("An unknown error occurred:",t)}}const w="TOK_LPAREN",$="TOK_RPAREN",U="TOK_LCURLY",N="TOK_RCURLY",ts="TOK_LSQUAR",es="TOK_RSQUAR",Tt="TOK_COMMA",ss="TOK_DOT",H="TOK_PLUS",C="TOK_MINUS",ft="TOK_STAR",mt="TOK_SLASH",kt="TOK_CARET",Ot="TOK_MOD",dt="TOK_SEMICOLON",is="TOK_QUESTION",le="TOK_NOT",Et="TOK_GT",$t="TOK_LT",xt="TOK_GE",gt="TOK_LE",St="TOK_NE",_t="TOK_EQEQ",Kt="TOK_ASSIGN",V="TOK_IDENTIFIER",ue="TOK_STRING",pe="TOK_INTEGER",Te="TOK_FLOAT",wt="TOK_IF",Nt="TOK_ELSE",fe="TOK_TRUE",me="TOK_FALSE",ke="TOK_AND",Oe="TOK_OR",bt="TOK_WHILE",ns="TOK_DO",vt="TOK_FOR",Rt="TOK_FUNC",rs="TOK_NULL",It="TOK_PRINT",yt="TOK_PRINTLN",Lt="TOK_RET",hs={if:wt,else:Nt,true:fe,false:me,while:bt,do:ns,for:vt,function:Rt,null:rs,print:It,println:yt,return:Lt};class os{constructor(t,e,s){i(this,"tokenType");i(this,"lexeme");i(this,"line");this.tokenType=t,this.lexeme=e,this.line=s}toString(){return`(${this.tokenType}, '${this.lexeme}', ${this.line})`}}class cs{constructor(t){i(this,"tokens");i(this,"source");i(this,"start");i(this,"curr");i(this,"line");this.source=t,this.start=0,this.curr=0,this.line=1,this.tokens=[]}advance(){const t=this.source[this.curr];return this.curr++,t}peek(){return this.curr>=this.source.length?"\0":this.source[this.curr]}lookahead(t=1){return this.curr+t>=this.source.length?"\0":this.source[this.curr+t]}match(t){return this.curr>=this.source.length||this.source[this.curr]!==t?!1:(this.curr++,!0)}handleNumber(){for(;/\d/.test(this.peek());)this.advance();if(this.peek()==="."&&/\d/.test(this.lookahead())){for(this.advance();/\d/.test(this.peek());)this.advance();this.addToken(Te)}else this.addToken(pe)}handleString(t){for(;this.peek()!==t&&this.curr<this.source.length;)this.advance();this.curr>=this.source.length&&y("Unterminated string.",this.line),this.advance(),this.addToken(ue)}handleIdentifier(){for(;/\w/.test(this.peek());)this.advance();const t=this.source.substring(this.start,this.curr),e=hs[t]||V;this.addToken(e)}addToken(t){const e=this.source.substring(this.start,this.curr);this.tokens.push(new os(t,e,this.line))}tokenize(){for(;this.curr<this.source.length;){this.start=this.curr;const t=this.advance();switch(t){case`
`:this.line++;break;case" ":case"	":case"\r":break;case"(":this.addToken(w);break;case")":this.addToken($);break;case"{":this.addToken(U);break;case"}":this.addToken(N);break;case"[":this.addToken(ts);break;case"]":this.addToken(es);break;case".":this.addToken(ss);break;case",":this.addToken(Tt);break;case"+":this.addToken(H);break;case"*":this.addToken(ft);break;case"^":this.addToken(kt);break;case"/":if(this.match("/"))for(;this.peek()!==`
`&&this.curr<this.source.length;)this.advance();else this.addToken(mt);break;case";":this.addToken(dt);break;case"?":this.addToken(is);break;case"%":this.addToken(Ot);break;case"-":this.addToken(C);break;case"=":this.addToken(this.match("=")?_t:Kt);break;case"!":this.addToken(this.match("=")?St:le);break;case"<":this.addToken(this.match("=")?gt:$t);break;case">":this.addToken(this.match("=")?xt:Et);break;case"|":this.match("|")?this.addToken(W):y(`Error at '${t}': Unexpected character.`,this.line);break;case"&":this.match("&")?this.addToken(D):y(`Error at '${t}': Unexpected character.`,this.line);break;case'"':case"'":this.handleString(t);break;default:/\d/.test(t)?this.handleNumber():/\w/.test(t)?this.handleIdentifier():y(`Error at '${t}': Unexpected character.`,this.line)}}return this.tokens}}class Ut{}class g extends Ut{}class _ extends Ut{}class de extends _{}class Ee extends g{constructor(e,s){super();i(this,"value");i(this,"line");if(!Number.isInteger(e))throw new Error(`Invalid Integer value: ${e}`);this.value=e,this.line=s}toString(){return`Integer[${this.value}]`}}class $e extends g{constructor(e,s){super();i(this,"value");i(this,"line");if(typeof e!="number")throw new Error(`Invalid Float value: ${e}`);this.value=e,this.line=s}toString(){return`Float[${this.value}]`}}class At extends g{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`Bool[${this.value}]`}}class xe extends g{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`String[${this.value}]`}}class ge extends g{constructor(e,s,n){super();i(this,"op");i(this,"operand");i(this,"line");this.op=e,this.operand=s,this.line=n}toString(){return`UnOp(${this.op.lexeme}, ${this.operand})`}}class b extends g{constructor(e,s,n,h){super();i(this,"op");i(this,"left");i(this,"right");i(this,"line");this.op=e,this.left=s,this.right=n,this.line=h}toString(){return`BinOp(${this.op.lexeme}, ${this.left}, ${this.right})`}}class Ft extends g{constructor(e,s,n,h){super();i(this,"op");i(this,"left");i(this,"right");i(this,"line");this.op=e,this.left=s,this.right=n,this.line=h}toString(){return`LogicalOp(${this.op.lexeme}, ${this.left}, ${this.right})`}}class Se extends g{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`Grouping(${this.value})`}}class _e extends g{constructor(e,s){super();i(this,"name");i(this,"line");this.name=e,this.line=s}toString(){return`Identifier[${this.name}]`}}class Ke extends Ut{constructor(e,s){super();i(this,"statements");i(this,"line");this.statements=e,this.line=s}toString(){return`Stmts(${this.statements})`}}class we extends _{constructor(e,s,n){super();i(this,"value");i(this,"end");i(this,"line");this.value=e,this.end=s,this.line=n}toString(){return`PrintStmt(${this.value}, end=${this.end})`}}class Ne extends _{constructor(e,s,n,h){super();i(this,"test");i(this,"thenStatements");i(this,"elseStatements");i(this,"line");this.test=e,this.thenStatements=s,this.elseStatements=n,this.line=h}toString(){return`IfStmt(${this.test}, then: ${this.thenStatements}, else: ${this.elseStatements})`}}class be extends _{constructor(e,s,n){super();i(this,"test");i(this,"bodyStatements");i(this,"line");this.test=e,this.bodyStatements=s,this.line=n}toString(){return`WhileStmt(${this.test}, ${this.bodyStatements})`}}class ve extends _{constructor(e,s,n){super();i(this,"left");i(this,"right");i(this,"line");this.left=e,this.right=s,this.line=n}toString(){return`Assignment(${this.left}, ${this.right})`}}class Re extends _{constructor(e,s,n,h,c,u){super();i(this,"identifier");i(this,"start");i(this,"end");i(this,"step");i(this,"bodyStatements");i(this,"line");this.identifier=e,this.start=s,this.end=n,this.step=h,this.bodyStatements=c,this.line=u}toString(){return`ForStmt(${this.identifier}, ${this.start}, ${this.end}, ${this.step}, ${this.bodyStatements})`}}class Ie extends de{constructor(e,s,n,h){super();i(this,"name");i(this,"params");i(this,"bodyStatements");i(this,"line");this.name=e,this.params=s,this.bodyStatements=n,this.line=h}toString(){return`FuncDecl(${this.name}, ${this.params}, ${this.bodyStatements})`}}class as extends de{constructor(e,s){super();i(this,"name");i(this,"line");this.name=e,this.line=s}toString(){return`Param(${this.name})`}}class ye extends g{constructor(e,s,n){super();i(this,"name");i(this,"args");i(this,"line");this.name=e,this.args=s,this.line=n}toString(){return`FuncCall(${this.name}, ${this.args})`}}class Le extends _{constructor(e){super();i(this,"expression");this.expression=e}toString(){return`FuncCallStmt(${this.expression})`}}class Ue extends _{constructor(e,s){super();i(this,"value");i(this,"line");this.value=e,this.line=s}toString(){return`RetStmt(${this.value})`}}class ls{constructor(t){i(this,"tokens");i(this,"curr");this.tokens=t,this.curr=0}advance(){const t=this.tokens[this.curr];return this.curr++,t}peek(){return this.tokens[this.curr]}isNext(t){return this.curr<this.tokens.length&&this.peek().tokenType===t}expect(t){if(this.curr>=this.tokens.length)L("Unexpected end of input",this.previousToken().line);else{if(this.peek().tokenType===t)return this.advance();L(`Expected ${t}, but found ${this.peek().lexeme}.`,this.peek().line)}}previousToken(){return this.tokens[this.curr-1]}match(t){return this.curr<this.tokens.length&&this.peek().tokenType===t?(this.curr++,!0):!1}primary(){if(this.match(pe))return new Ee(parseInt(this.previousToken().lexeme),this.previousToken().line);if(this.match(Te))return new $e(parseFloat(this.previousToken().lexeme),this.previousToken().line);if(this.match(fe))return new At(!0,this.previousToken().line);if(this.match(me))return new At(!1,this.previousToken().line);if(this.match(ue))return new xe(this.previousToken().lexeme.slice(1,-1),this.previousToken().line);if(this.match(w)){const t=this.expr();return this.expect($),t?new Se(t,this.previousToken().line):null}else{const t=this.expect(V);if(typeof t<"u"){if(this.match(w)){const e=this.args();return this.expect($),new ye(t.lexeme,e,this.previousToken().line)}return new _e(t.lexeme,this.previousToken().line)}return null}}unary(){if(this.match(le)||this.match(C)||this.match(H)){const t=this.previousToken(),e=this.unary();return e?new ge(t,e,t.line):null}return this.primary()}exponent(){let t=this.unary();for(;this.match(kt);){const e=this.previousToken(),s=this.exponent();t&&s&&(t=new b(e,t,s,e.line))}return t}modulo(){let t=this.exponent();for(;this.match(Ot);){const e=this.previousToken(),s=this.exponent();t&&s&&(t=new b(e,t,s,e.line))}return t}multiplication(){let t=this.modulo();for(;this.match(ft)||this.match(mt);){const e=this.previousToken(),s=this.modulo();t&&s&&(t=new b(e,t,s,e.line))}return t}addition(){let t=this.multiplication();for(;this.match(H)||this.match(C);){const e=this.previousToken(),s=this.multiplication();t&&s&&(t=new b(e,t,s,e.line))}return t}comparison(){let t=this.addition();for(;this.match(Et)||this.match(xt)||this.match($t)||this.match(gt);){const e=this.previousToken(),s=this.addition();t&&s&&(t=new b(e,t,s,e.line))}return t}equality(){let t=this.comparison();for(;this.match(St)||this.match(_t);){const e=this.previousToken(),s=this.comparison();t&&s&&(t=new b(e,t,s,e.line))}return t}logicalAnd(){let t=this.equality();for(;this.match(ke);){const e=this.previousToken(),s=this.equality();t&&s&&(t=new Ft(e,t,s,e.line))}return t}logicalOr(){let t=this.logicalAnd();for(;this.match(Oe);){const e=this.previousToken(),s=this.logicalAnd();t&&s&&(t=new Ft(e,t,s,e.line))}return t}expr(){return this.logicalOr()}printStmt(t){if(this.match(It)||this.match(yt)){const e=this.expr();return e?new we(e,t,this.previousToken().line):null}return null}ifStmt(){this.expect(wt),this.expect(w);const t=this.expr();this.expect($),this.expect(U);const e=this.stmts();this.expect(N);let s=null;return this.isNext(Nt)&&(this.advance(),this.expect(U),s=this.stmts(),this.expect(N)),t?new Ne(t,e,s,this.previousToken().line):null}whileStmt(){this.expect(bt),this.expect(w);const t=this.expr();this.expect($),this.expect(U);const e=this.stmts();return this.expect(N),t?new be(t,e,this.previousToken().line):null}forStmt(){this.expect(vt),this.expect(w);const t=this.primary();this.expect(Kt);const e=this.expr();this.expect(dt);const s=this.expr();let n=null;this.isNext(dt)&&(this.advance(),n=this.expr()),this.expect($),this.expect(U);const h=this.stmts();return this.expect(N),t&&e&&s?new Re(t,e,s,n,h,this.previousToken().line):null}args(){let t=[];for(;!this.isNext($);){let e=this.expr();e&&(t.push(e),this.isNext($)||this.expect(Tt))}return t}params(){const t=[];let e=0;for(;!this.isNext($);){const s=this.expect(V);typeof s>"u"||(e++,e>255&&L("Functions cannot have more than 255 parameters.",s?s.line:0),t.push(new as(s.lexeme,this.previousToken().line)),this.isNext($)||this.expect(Tt))}return t}funcDecl(){this.expect(Rt);const t=this.expect(V);if(typeof t>"u")return null;this.expect(w);const e=this.params();this.expect($),this.expect(U);const s=this.stmts();return this.expect(N),new Ie(t.lexeme,e,s,t.line)}retStmt(){this.expect(Lt);const t=this.expr();return t?new Ue(t,this.previousToken().line):null}stmt(){const t=this.peek().tokenType;if(t===It)return this.printStmt("");if(t===yt)return this.printStmt(`
`);if(t===wt)return this.ifStmt();if(t===bt)return this.whileStmt();if(t===vt)return this.forStmt();if(t===Rt)return this.funcDecl();if(t===Lt)return this.retStmt();const e=this.expr();if(!e)return null;if(this.match(Kt)){const s=this.expr();return s?new ve(e,s,this.previousToken().line):null}return new Le(e)}stmts(){const t=[];for(;this.curr<this.tokens.length&&!this.isNext(Nt)&&!this.isNext(N);){let e=this.stmt();e&&t.push(e)}return new Ke(t,this.previousToken().line)}program(){return this.stmts()}parse(){return this.program()}}class Gt{constructor(t=null){i(this,"vars");i(this,"funcs");i(this,"parent");this.vars={},this.funcs={},this.parent=t}getVar(t){let e=this;for(;e;){if(t in e.vars)return e.vars[t];e=e.parent}}setVar(t,e){let s=this;for(;s;){if(t in s.vars)return s.vars[t]=e,e;s=s.parent}return this.vars[t]=e,e}getFunc(t){let e=this;for(;e;){if(t in e.funcs)return e.funcs[t];e=e.parent}}setFunc(t,e){this.funcs[t]=e}newEnv(){return new Gt(this)}}class Ae extends Error{constructor(e){super("Return statement");i(this,"value");this.value=e}}const l="TYPE_NUMBER",k="TYPE_STRING",d="TYPE_BOOL";class us{interpret(t,e){if(t instanceof Ee)return[l,t.value];if(t instanceof $e)return[l,t.value];if(t instanceof xe)return[k,t.value];if(t instanceof At)return[d,t.value];if(t instanceof Se)return this.interpret(t.value,e);if(t instanceof _e){const s=e.getVar(t.name);return s||T(`Undeclared identifier '${t.name}'`,t.line),s[1]===null&&T(`Uninitialized identifier '${t.name}'`,t.line),s}if(t instanceof ve){const[s,n]=this.interpret(t.right,e);e.setVar(t.left.name,[s,n])}if(t instanceof b){const[s,n]=this.interpret(t.left,e),[h,c]=this.interpret(t.right,e);switch(t.op.tokenType){case H:if(s===l&&h===l)return[l,n+c];if(s===k||h===k)return[k,I(n)+I(c)];break;case C:if(s===l&&h===l)return[l,n-c];break;case ft:if(s===l&&h===l)return[l,n*c];break;case mt:if(h===0&&T("Division by zero.",t.line),s===l&&h===l)return[l,n/c];break;case Ot:if(s===l&&h===l)return[l,n%c];break;case kt:if(s===l&&h===l)return[l,n**c];break;case Et:if(s===l&&h===l||s===k&&h===k)return[d,n>c];break;case xt:if(s===l&&h===l||s===k&&h===k)return[d,n>=c];break;case $t:if(s===l&&h===l||s===k&&h===k)return[d,n<c];break;case gt:if(s===l&&h===l||s===k&&h===k)return[d,n<=c];break;case _t:if(s===l&&h===l||s===k&&h===k||s===d&&h===d)return[d,n===c];break;case St:if(s===l&&h===l||s===k&&h===k||s===d&&h===d)return[d,n!==c];break;default:T(`Unsupported operator '${t.op.lexeme}'`,t.line)}}if(t instanceof ge){const[s,n]=this.interpret(t.operand,e);switch(t.op.tokenType){case"TOK_MINUS":if(s===l)return[l,-n];break;case"TOK_PLUS":if(s===l)return[l,n];break;case"TOK_NOT":if(s===d)return[d,!n];break;default:T(`Unsupported operator '${t.op.lexeme}'`,t.line)}}if(t instanceof Ft){const[s,n]=this.interpret(t.left,e);switch(t.op.tokenType){case Oe:if(n)return[s,n];break;case ke:if(!n)return[s,n];break}return this.interpret(t.right,e)}if(t instanceof Ke)for(const s of t.statements)this.interpret(s,e);if(t instanceof we){const[,s]=this.interpret(t.value,e);console.log(I(s),t.end===`
`?`
`:"")}if(t instanceof Ne){const[s,n]=this.interpret(t.test,e);s!==d&&T("Condition test is not a boolean expression.",t.line),n?this.interpret(t.thenStatements,e.newEnv()):t.elseStatements&&this.interpret(t.elseStatements,e.newEnv())}if(t instanceof be)for(;;){const[s,n]=this.interpret(t.test,e);if(s!==d&&T("While test is not a boolean expression.",t.line),!n)break;this.interpret(t.bodyStatements,e.newEnv())}if(t instanceof Re){const s=t.identifier.name,[,n]=this.interpret(t.start,e),[,h]=this.interpret(t.end,e),c=e.newEnv();let u;if(n<h){u=t.step?this.interpret(t.step,e)[1]:1;for(let p=n;p<=h;p+=u)e.setVar(s,[l,p]),this.interpret(t.bodyStatements,c)}else{u=t.step?this.interpret(t.step,e)[1]:-1;for(let p=n;p>=h;p+=u)e.setVar(s,[l,p]),this.interpret(t.bodyStatements,c)}}if(t instanceof Ie&&e.setFunc(t.name,[t,e]),t instanceof ye){const s=e.getFunc(t.name);s||T(`Function '${t.name}' not declared.`,t.line);const[n,h]=s;t.args.length!==n.params.length&&T(`Function '${n.name}' expected ${n.params.length} arguments but got ${t.args.length}.`,t.line);const c=h.newEnv();n.params.forEach((u,p)=>{c.setVar(u.name,this.interpret(t.args[p],e))});try{this.interpret(n.bodyStatements,c)}catch(u){if(u instanceof Ae)return u.value;throw u}}if(t instanceof Le&&this.interpret(t.expression,e),t instanceof Ue)throw new Ae(this.interpret(t.value,e))}interpretAst(t){const e=new Gt;this.interpret(t,e)}}function ps(r){console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}SOURCE:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(r),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}TOKENS:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`);const t=new cs(r);let e;e=t.tokenize(),e.forEach(c=>console.log(c)),console.log(),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}AST:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`);const n=new ls(e).parse();Bt(n.toString()),console.log(),console.log(`${o.GREEN}***************************************${o.WHITE}`),console.log(`${o.GREEN}INTERPRETER:${o.WHITE}`),console.log(`${o.GREEN}***************************************${o.WHITE}`),new us().interpretAst(n)}document.addEventListener("DOMContentLoaded",function(){let r;r=document.scripts;for(let t=0;t<r.length;t++){const e=r[t];e.type==="text/pinky"?Ze(e.text):e.type==="text/ccode"&&ps(e.text)}})});
